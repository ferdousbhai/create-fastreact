# {{projectName}}

A full-stack app built with [fastreact](https://www.npmjs.com/package/create-fastreact).

## Prerequisites

- [Modal CLI](https://modal.com/docs/guide) installed and logged in (`modal token new`)
- [Modal Proxy Auth Token](https://modal.com/settings/proxy-auth-tokens) created

## Stack

**Frontend**
- React 19 + Vite + TypeScript
- Tailwind CSS v4
- shadcn/ui (New York style)

**Backend**
- FastAPI on Modal (serverless)
- Proxy authentication enabled

## Setup

Before starting development, you need:

1. **Modal CLI authentication**: `modal token new`
2. **Proxy auth token**: Create at https://modal.com/settings/proxy-auth-tokens
3. **Configure frontend**: Add to `frontend/.env.local`:
   ```
   VITE_MODAL_KEY=<token-id>
   VITE_MODAL_SECRET=<token-secret>
   VITE_API_URL=<modal-serve-url>
   ```

## Development

```bash
pnpm run dev
```

This starts both:
- **Frontend**: http://localhost:5173
- **Backend**: Modal serve (with proxy auth)

The backend runs on Modal's infrastructure. The URL changes each time you restart `modal serve` - update `VITE_API_URL` in `frontend/.env.local` if needed.

## Production Deployment

Deployment is automated via the agent. When all features pass, run a deployment session.

## Security

**Proxy authentication is enabled from day 1:**

- **Proxy Auth**: All API requests require `Modal-Key` and `Modal-Secret` headers
- **CORS**: Allows all origins (security is enforced by proxy auth, not CORS)
- **Secrets**: Stored in Modal secrets, never in code

The frontend automatically includes auth headers in all API requests when `VITE_MODAL_KEY` and `VITE_MODAL_SECRET` are configured.

## Using the API

```typescript
import { api } from "@/lib/api";

// GET request
const data = await api<{ message: string }>("/api/hello?name=World");

// POST request
const result = await api("/api/items", {
  method: "POST",
  body: JSON.stringify({ name: "item" }),
});
```

The `api` helper automatically includes Modal auth headers.

## Adding shadcn Components

```bash
cd frontend
pnpm dlx shadcn@latest add button
```

## Adding Backend Functions

For functions called from the frontend (HTTP), use `@modal.asgi_app()`:

```python
# Already configured in modal_app.py
@app.function(image=image, secrets=[secrets])
@modal.asgi_app(requires_proxy_auth=True)
def fastapi_app():
    from app.main import app
    return app
```

For internal functions (called from other backend code), use `.remote()`:

```python
@app.function(image=image, gpu="A10G")
def heavy_compute(data: dict) -> dict:
    # Runs on separate container
    return {"result": "processed"}

# Call from FastAPI route:
result = heavy_compute.remote(data)
```

## API Endpoints

- `GET /api/health` - Health check
- `GET /api/hello?name=World` - Hello endpoint
